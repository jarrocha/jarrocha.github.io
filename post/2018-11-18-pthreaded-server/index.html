<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="Innercoder.dev">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://jarrocha.github.io/img/iot.jpg">
    <meta property="twitter:image" content="https://jarrocha.github.io/img/iot.jpg" />
    

    
    <meta name="title" content="Implementing a Prethreaded Web Server" />
    <meta property="og:title" content="Implementing a Prethreaded Web Server" />
    <meta property="twitter:title" content="Implementing a Prethreaded Web Server" />
    

    
    <meta name="description" content="Create a pool of threads to handle server work.">
    <meta property="og:description" content="Create a pool of threads to handle server work." />
    <meta property="twitter:description" content="Create a pool of threads to handle server work." />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="Linux, C, C&#43;&#43;, macOS, mbedOS">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>Implementing a Prethreaded Web Server-Innercoder.dev</title>

    <link rel="canonical" href="/post/2018-11-18-pthreaded-server/">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">
    
    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    
    

    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>

    
    

</head>



<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Innercoder.dev</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                        
                    
                    
		    
                        <li><a href="/top/upcoming/">UPCOMING</a></li>
                    
                        <li><a href="/top/courses/">COURSES</a></li>
                    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
		    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15" style="cursor: pointer;" alt="Search"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/post-bg-unix-linux.jpg')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/c" title="C">
                            C
                        </a>
                        
                        <a class="tag" href="/tags/tcp/ip" title="TCP/IP">
                            TCP/IP
                        </a>
                        
                        <a class="tag" href="/tags/linux" title="Linux">
                            Linux
                        </a>
                        
                    </div>
                    <h1>Implementing a Prethreaded Web Server</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by 
                        
                            Jaime Arrocha
                         
                        on 
                        Wednesday, July 13, 2016
                        
                        
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>
                
                
                <p>p&gt;In this post I will analyze an implementation of a prethreaded TCP server that
leverages the HTTP protocol. This is a personal ongoing project that will
continue its
development and I found it to be at a good place to start sharing what I have
done so far. The whole purpose of this is to later on built a tool to test its
performance and how to break it with malformed packets. It is such an
interesting project that everytime I sit down with it, I start thinking about
different features to implement on it. Again all this is coded in C with the
POSIX threads and sockets API.</p></p>

<p>The current implementation of this server hanldes HTTP GET request with a pool
of threads. The amount of threads in the pool is given as an argument to the
program. One interesting feature that I have in mind is for the server to deduce
the size of the thread pool based on the number of cores and the current load as
a default option. The previous version of this server was handling threads per
request, which is not very efficient.</p>

<p>The analysis I will do is quick and to the point. These are two very
interesting APIs (threads, &amp; sockets) that are relatively easy to follow, once
you have some experience.</p>

<p>The complete code is at its <a href="https://github.com/jarrocha/xwbserver">github repository</a>.</p>

<h4>utils.c</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="cm">/* usage function */</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">usage</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage: %s &lt;PORT&gt; &lt;DIRECTORY&gt; &lt;#THREADS&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
</span><span class='line'>  <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>Usage function, currently all arguments are obligatory. Another future feature
to add is for the server to be binded to a specifi interface and work as a
daemon.</p>

<h4>main.c</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="cm">/* pthread functions */</span>
</span><span class='line'><span class="kt">void</span> <span class="o">*</span><span class="nf">thr_func</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* initializing mutex lock */</span>
</span><span class='line'><span class="kt">pthread_mutex_t</span> <span class="n">mtx</span> <span class="o">=</span> <span class="n">PTHREAD_MUTEX_INITIALIZER</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* static globals */</span>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">listenfd</span><span class="p">;</span>
</span><span class='line'><span class="k">static</span> <span class="kt">char</span> <span class="n">fname</span><span class="p">[</span><span class="n">FILEDAT</span><span class="p">];</span> <span class="cm">/* holds webserver directory */</span>
</span></code></pre></td></tr></table></div></figure>

<p>Global variables. Here we have the funtion that is called by pthread_create(),
the mutex initializer, the globally shared listening socket file descriptor, and
a buffer for the server file directory.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="cm">/* server socket variables */</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">port</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">nthreads</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">optval</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">svaddr</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/* handling webserver arguments */</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span>
</span><span class='line'>      <span class="n">usage</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>  <span class="n">port</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>      <span class="cm">/* !!No bounds checking */</span>
</span><span class='line'>  <span class="n">strcpy</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>        <span class="cm">/* !!No bounds checking */</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* thread structure initialization */</span>
</span><span class='line'>  <span class="n">nthreads</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</span><span class='line'>  <span class="k">struct</span> <span class="kr">thread</span> <span class="o">*</span><span class="n">thr_ctl</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="kr">thread</span><span class="p">)</span> <span class="o">*</span> <span class="n">nthreads</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">thr_ctl</span><span class="p">)</span>
</span><span class='line'>      <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error allocating thr_ctl&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* initializing server address socket */</span>
</span><span class='line'>  <span class="n">svaddr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span><span class='line'>  <span class="n">svaddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">INADDR_ANY</span><span class="p">);</span>
</span><span class='line'>  <span class="n">svaddr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span> <span class="n">port</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/* defining listening socket descriptor */</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="n">listenfd</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">svaddr</span><span class="p">.</span><span class="n">sin_family</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
</span><span class='line'>      <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error on socket()&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,</span> <span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">optval</span><span class="p">,</span>
</span><span class='line'>              <span class="k">sizeof</span><span class="p">(</span><span class="n">optval</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error on setsockopt()&quot;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/* bind socket to IP address */</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">svaddr</span><span class="p">,</span>
</span><span class='line'>              <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error on bind()&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* listen on socket */</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="n">listen</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,</span> <span class="n">LISTENQ</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error on listen()&quot;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* pre-threading procedure */</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">nthreads</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span><span class="p">((</span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">thr_ctl</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">thr_func</span><span class="p">,(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">x</span><span class="p">))</span>
</span><span class='line'>          <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>          <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;Thread create error&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">((</span><span class="n">pthread_detach</span><span class="p">(</span><span class="n">thr_ctl</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">tid</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>          <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;Thread detach error&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span><span class="p">(;;)</span>
</span><span class='line'>      <span class="n">pause</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>Tried commenting as much as possible. It sums to initializing important socket
variables, handling arguments for port and thread number, setting up the
server socket address structure and its setup for connections, and at the end,
the procedure for prethreading.</p>

<p>For the prethreading procedure, all threads are keep in control with a structure
. Currently this structure is not doing anything but to keep an index to them,
but I will later on use it for displaying statistics of thread usage and
logging. Also, there&rsquo;s not main thread waiting for other&rsquo;s to finish, as soon
as they are created they are detached for now.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="kt">void</span> <span class="o">*</span><span class="nf">thr_func</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="cm">/* variables to handle http process */</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="n">DATLEN</span><span class="p">];</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">st_trx</span> <span class="o">*</span><span class="n">wb_trx</span><span class="p">;</span>
</span><span class='line'>  <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">claddr</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">socklen_t</span> <span class="n">sin_size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">claddr</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* main procedure */</span>
</span><span class='line'>  <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">wb_trx</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">((</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">st_trx</span><span class="p">)));</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wb_trx</span><span class="p">)</span>
</span><span class='line'>          <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error allocating wb_trx&quot;</span><span class="p">);</span> 
</span><span class='line'>      
</span><span class='line'>      <span class="cm">/* initialize web file struct */</span>
</span><span class='line'>      <span class="n">strcpy</span><span class="p">(</span><span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">file_name</span><span class="p">,</span> <span class="n">fname</span><span class="p">);</span>
</span><span class='line'>      <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">stat_ct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">dyn_ct</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mtx</span><span class="p">);</span>    
</span><span class='line'>      <span class="k">if</span> <span class="p">((</span><span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">trx_fd</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">listenfd</span><span class="p">,</span>
</span><span class='line'>                      <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">claddr</span><span class="p">,</span>
</span><span class='line'>                      <span class="o">&amp;</span><span class="n">sin_size</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>          <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error on accept()&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mtx</span><span class="p">);</span>  
</span><span class='line'>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;server: got connection from %s port %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span class='line'>              <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">claddr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">),</span>
</span><span class='line'>              <span class="n">ntohs</span><span class="p">(</span><span class="n">claddr</span><span class="p">.</span><span class="n">sin_port</span><span class="p">));</span>
</span><span class='line'>      
</span><span class='line'>      <span class="cm">/* Read request line and headers */</span>
</span><span class='line'>      <span class="n">recv_msg</span><span class="p">(</span><span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">trx_fd</span><span class="p">,</span> <span class="n">buff</span><span class="p">,</span> <span class="n">DATLEN</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">sscanf</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="s">&quot;%s %s %s&quot;</span><span class="p">,</span> <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">method</span><span class="p">,</span> <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">uri</span><span class="p">,</span>
</span><span class='line'>             <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">ver</span><span class="p">);</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;method: %s</span><span class="se">\n</span><span class="s">uri: %s</span><span class="se">\n</span><span class="s">ver: %s</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">method</span><span class="p">,</span>
</span><span class='line'>             <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">uri</span><span class="p">,</span> <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">ver</span><span class="p">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">serve_rq</span><span class="p">(</span><span class="n">wb_trx</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>With main() and serve_rq(), this is one of the most important functions so far.
The <strong>struct st_trx *wb_trx</strong> pointer variable is allocated and contains all the
information from a client (web browser) request. This structure is filled with
the data read from the socket buffer and send to <strong>serve_rq()</strong> for processing.
There are still some variables that are initialized and serve no purpose.</p>

<h4>utils.c</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="cm">/* serve static content */</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">serve_rq</span><span class="p">(</span><span class="k">struct</span> <span class="n">st_trx</span> <span class="o">*</span><span class="n">wb_trx</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">addr</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cm">/* get file stats */</span>
</span><span class='line'>  <span class="n">get_file_stats</span><span class="p">(</span><span class="n">wb_trx</span><span class="p">);</span>
</span><span class='line'>      
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="n">addr</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">file_size</span><span class="p">,</span> <span class="n">PROT_READ</span><span class="p">,</span> <span class="n">MAP_PRIVATE</span><span class="p">,</span>
</span><span class='line'>           <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">file_fd</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">==</span> <span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span class='line'>      <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error on mmap()&quot;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">close</span><span class="p">(</span><span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">file_fd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error closing filefd&quot;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">call_http</span><span class="p">(</span><span class="s">&quot;200&quot;</span><span class="p">,</span> <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">trx_fd</span><span class="p">,</span> <span class="n">wb_trx</span><span class="p">);</span>
</span><span class='line'>  <span class="n">send_msg</span><span class="p">(</span><span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">trx_fd</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">munmap</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">wb_trx</span><span class="o">-&gt;</span><span class="n">file_size</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;munmap() error&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="cm">/* freeing web transaction */</span>
</span><span class='line'>  <span class="n">free</span><span class="p">(</span><span class="n">wb_trx</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>This is the function that currently gets <strong>.html</strong> stored file data from server
and calls respective http functions. The plan is to have one function with
centralized movement, sort of spoke and hub communication. The current HTTP api
functions need to be made to return status.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="cm">/* receive msg function */</span>
</span><span class='line'><span class="kt">size_t</span> <span class="nf">recv_msg</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">usr_buff</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">size_t</span> <span class="n">nleft</span> <span class="o">=</span> <span class="n">nbytes</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">ssize_t</span> <span class="n">nrecv</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">recv_buff</span> <span class="o">=</span> <span class="n">usr_buff</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="n">nleft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">((</span><span class="n">nrecv</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">recv_buff</span><span class="p">,</span> <span class="n">nleft</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">errno</span> <span class="o">==</span> <span class="n">EINTR</span><span class="p">)</span>
</span><span class='line'>              <span class="n">nrecv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>          <span class="k">else</span>
</span><span class='line'>              <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;recv() error&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">nrecv</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">||</span> <span class="n">strstr</span><span class="p">(</span><span class="n">recv_buff</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">))</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="n">nleft</span> <span class="o">-=</span> <span class="n">nrecv</span><span class="p">;</span>
</span><span class='line'>      <span class="n">recv_buff</span> <span class="o">+=</span> <span class="n">nrecv</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">nbytes</span> <span class="o">-</span> <span class="n">nleft</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* send msg function */</span>
</span><span class='line'><span class="kt">size_t</span> <span class="nf">send_msg</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buff</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">size_t</span> <span class="n">nleft</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buff</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">ssize_t</span> <span class="n">nsend</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/* send content */</span>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Bytes to send: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">nleft</span><span class="p">);</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="n">nleft</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">((</span><span class="n">nsend</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buff</span><span class="p">,</span> <span class="n">nleft</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span> <span class="n">nsend</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">errno</span> <span class="o">==</span> <span class="n">EINTR</span><span class="p">)</span>
</span><span class='line'>              <span class="n">nsend</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>          <span class="k">else</span>
</span><span class='line'>              <span class="n">error_msg</span><span class="p">(</span><span class="s">&quot;error with send()&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">nleft</span> <span class="o">-=</span> <span class="n">nsend</span><span class="p">;</span>
</span><span class='line'>      <span class="n">buff</span> <span class="o">+=</span> <span class="n">nsend</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">nleft</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Send success!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">nleft</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>These function still need some work with the return values and error detection
. It is another of the high priorities. They are wrappers to the send() and
recv() socket function calls.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='C'><span class='line'><span class="p">[</span><span class="n">jaime</span><span class="err">@</span><span class="n">LenoLX</span> <span class="n">xwbserver</span><span class="p">]</span><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">xwbserver</span> <span class="mi">5600</span> <span class="p">.</span> <span class="mi">8</span>
</span><span class='line'><span class="nl">server</span><span class="p">:</span> <span class="n">got</span> <span class="n">connection</span> <span class="n">from</span> <span class="mf">127.0.0.1</span> <span class="n">port</span> <span class="mi">50451</span>
</span><span class='line'><span class="nl">method</span><span class="p">:</span> <span class="n">GET</span>
</span><span class='line'><span class="nl">uri</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">-</span><span class="n">dyn</span><span class="p">.</span><span class="n">html</span>
</span><span class='line'><span class="nl">ver</span><span class="p">:</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
</span><span class='line'>
</span><span class='line'><span class="nl">Filename</span><span class="p">:</span> <span class="p">.</span><span class="o">/</span><span class="n">home</span><span class="o">-</span><span class="n">dyn</span><span class="p">.</span><span class="n">html</span>
</span><span class='line'><span class="n">Bytes</span> <span class="n">to</span> <span class="nl">send</span><span class="p">:</span> <span class="mi">83</span>
</span><span class='line'><span class="n">Send</span> <span class="n">success</span><span class="o">!!</span>
</span><span class='line'><span class="n">Bytes</span> <span class="n">to</span> <span class="nl">send</span><span class="p">:</span> <span class="mi">407</span>
</span><span class='line'><span class="n">Send</span> <span class="n">success</span><span class="o">!!</span>
</span><span class='line'><span class="nl">server</span><span class="p">:</span> <span class="n">got</span> <span class="n">connection</span> <span class="n">from</span> <span class="mf">127.0.0.1</span> <span class="n">port</span> <span class="mi">50452</span>
</span><span class='line'><span class="nl">method</span><span class="p">:</span> <span class="n">GET</span>
</span><span class='line'><span class="nl">uri</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">-</span><span class="n">pic1</span><span class="p">.</span><span class="n">html</span>
</span><span class='line'><span class="nl">ver</span><span class="p">:</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
</span><span class='line'>
</span><span class='line'><span class="nl">Filename</span><span class="p">:</span> <span class="p">.</span><span class="o">/</span><span class="n">home</span><span class="o">-</span><span class="n">pic1</span><span class="p">.</span><span class="n">html</span>
</span><span class='line'><span class="n">Bytes</span> <span class="n">to</span> <span class="nl">send</span><span class="p">:</span> <span class="mi">83</span>
</span><span class='line'><span class="n">Send</span> <span class="n">success</span><span class="o">!!</span>
</span><span class='line'><span class="n">Bytes</span> <span class="n">to</span> <span class="nl">send</span><span class="p">:</span> <span class="mi">270</span>
</span><span class='line'><span class="n">Send</span> <span class="n">success</span><span class="o">!!</span>
</span><span class='line'><span class="nl">server</span><span class="p">:</span> <span class="n">got</span> <span class="n">connection</span> <span class="n">from</span> <span class="mf">127.0.0.1</span> <span class="n">port</span> <span class="mi">50453</span>
</span><span class='line'><span class="nl">method</span><span class="p">:</span> <span class="n">GET</span>
</span><span class='line'><span class="nl">uri</span><span class="p">:</span> <span class="o">/</span><span class="n">smiley</span><span class="p">.</span><span class="n">gif</span>
</span><span class='line'><span class="nl">ver</span><span class="p">:</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
</span><span class='line'>
</span><span class='line'><span class="nl">Filename</span><span class="p">:</span> <span class="p">.</span><span class="o">/</span><span class="n">smiley</span><span class="p">.</span><span class="n">gif</span>
</span><span class='line'><span class="n">File</span> <span class="n">not</span> <span class="n">found</span>
</span><span class='line'><span class="n">Bytes</span> <span class="n">to</span> <span class="nl">send</span><span class="p">:</span> <span class="mi">142</span>
</span><span class='line'><span class="n">Send</span> <span class="n">success</span><span class="o">!!</span>
</span><span class='line'><span class="nl">server</span><span class="p">:</span> <span class="n">got</span> <span class="n">connection</span> <span class="n">from</span> <span class="mf">127.0.0.1</span> <span class="n">port</span> <span class="mi">50454</span>
</span><span class='line'><span class="nl">method</span><span class="p">:</span> <span class="n">GET</span>
</span><span class='line'><span class="nl">uri</span><span class="p">:</span> <span class="o">/</span><span class="n">landscape</span><span class="p">.</span><span class="n">jpg</span>
</span><span class='line'><span class="nl">ver</span><span class="p">:</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
</span><span class='line'>
</span><span class='line'><span class="nl">Filename</span><span class="p">:</span> <span class="p">.</span><span class="o">/</span><span class="n">landscape</span><span class="p">.</span><span class="n">jpg</span>
</span><span class='line'><span class="n">Bytes</span> <span class="n">to</span> <span class="nl">send</span><span class="p">:</span> <span class="mi">85</span>
</span><span class='line'><span class="n">Send</span> <span class="n">success</span><span class="o">!!</span>
</span><span class='line'><span class="n">Bytes</span> <span class="n">to</span> <span class="nl">send</span><span class="p">:</span> <span class="mi">4</span>
</span><span class='line'><span class="n">Send</span> <span class="n">success</span><span class="o">!!</span>
</span></code></pre></td></tr></table></div></figure>

<p>Usage example using a browser.</p>

                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/2018-11-18-performance-analysis-ii/" data-toggle="tooltip" data-placement="top" title="Code Performance Analysis With Assembly &amp; C: Part 2">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/2018-11-18-sockets-http/" data-toggle="tooltip" data-placement="top" title="Capturing Websites With Sockets and HTTP">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                
<div id="disqus-comment"></div>



            </div>
            
            <div class="
                col-lg-11 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        <a href="/tags/arm" title="ARM">
                            ARM
                        </a>
                        
                        
                        
                        <a href="/tags/bash" title="Bash">
                            Bash
                        </a>
                        
                        
                        
                        <a href="/tags/c" title="C">
                            C
                        </a>
                        
                        
                        
                        <a href="/tags/development" title="Development">
                            Development
                        </a>
                        
                        
                        
                        <a href="/tags/kvm" title="KVM">
                            KVM
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/linux" title="Linux">
                            Linux
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/qemu" title="QEMU">
                            QEMU
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/tcp/ip" title="TCP/IP">
                            TCP/IP
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/x86-assembly" title="x86 Assembly">
                            x86 Assembly
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                    
                    <li>
                        <a href="mailto:jarrocha@linux.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/jarrocha">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://gitlab.com/jarrocha27">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-gitlab fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/jaime-arrocha-337b0488/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    <li>
                        <a target="_blank" href="https://stackoverflow.com/users/3848072/jarr">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
            
                    
                    
                    
            
            
            
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; Innercoder.dev 2020
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
